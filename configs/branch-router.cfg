! Clinic Branch Router (Cisco IOS) - site-to-site IPsec, VLAN handoff
hostname CLINIC-A-ROUTER
no ip domain-lookup
!
! Interfaces
interface GigabitEthernet0/0
 description WAN-to-HQ
 ip address 172.16.100.2 255.255.255.252
 no shutdown
!
interface GigabitEthernet0/1
 description To-ClinicA-Switch (trunk)
 no shutdown
!
! Sub-interfaces for VLANs (dot1q tagging)
interface GigabitEthernet0/1.30
 encapsulation dot1Q 30
 ip address 10.110.30.1 255.255.255.0
!
interface GigabitEthernet0/1.70
 encapsulation dot1Q 70
 ip address 10.110.70.1 255.255.255.0
!
! Static route to reach HQ networks via WAN peer
ip route 10.10.0.0 255.255.0.0 172.16.100.1
!
! Basic IPsec site-to-site config (IKEv1 example)
crypto isakmp policy 10
 encr aes
 hash sha256
 authentication pre-share
 group 14
 lifetime 86400
!
crypto isakmp key <PRE_SHARED_KEY> address 172.16.100.1
!
crypto ipsec transform-set TS esp-aes esp-sha256-hmac
!
crypto map CMAP 10 ipsec-isakmp
 set peer 172.16.100.1
 set transform-set TS
 match address 110
!
interface GigabitEthernet0/0
 crypto map CMAP
!
! ACL for interesting traffic (to/from HQ)
access-list 110 permit ip 10.110.0.0 0.0.255.255 10.10.0.0 0.0.255.255
!
end

